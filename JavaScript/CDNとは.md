*目次*
* [CDNとは](#CDNとは)
* [必要になった背景](#必要になった背景)
* [デメリット](#デメリット)
* [セキュリティ](#セキュリティ)
* [SRIを使ったCDNの利用方法](#SRIを使ったCDNの利用方法)
* [integrity属性](#integrity属性)
* [crossorigin属性](#crossorigin属性)
* [ドメインとオリジンの違い](#ドメインとオリジンの違い)
* [HTTPリクエスト](#HTTPリクエスト)
* [CORSとは](#CORSとは)

### CDNとは

コンテンツを配信する仕組みの一種。Content Delivery Networkの略。

複数の地域に配置されたサーバーを利用し、各ユーザーに最も近いサーバーからデータを取得することができる。

これは、例えるなら車のトラブルがあった時に来てくれるJAFのサービスに似ている。  
JAFも依頼のあった場所から近い場所に住んでいるJAFスタッフの人が来てくれる。

これと同じように、CDNもユーザーからファイルの要求があったら、そのユーザーの場所に一番近いサーバーを通じてファイルを届ける。  
そのため、**CDNを使うと高速でコンテンツを配信することができる。**

### 必要になった背景

CDNが必要になった背景の一つに、海外からのアクセスがあった際の表示速度を速めることがあげられる。

海外から日本のWebサービスにアクセスする場合、ページの表示までに時間がかかってしまうことがある。

これは**オリジンサーバ**(それぞれのWebサイトを管理しているサーバ)との物理的な距離が遠ければ遠いほど、webページの表示が遅くなるためだ。  
このため海外のユーザーをターゲットとしているWebサービスなどでは、現地でのコンテンツ表示速度の向上が課題となっていた。

### デメリット

便利な反面、デメリットも存在する。

* **CDN提供元の影響を受ける**

CDNを提供しているサービスはいくつかあるが、そのCDNの提供元が障害を起こすことがあり、それが原因でアプリなどのサービスが動かなくなることがある。

そのため、CDNを利用する場合はこういった提供元の影響も頭に入れておく必要がある。

* **サービス終了のリスク**

CDNを提供しているサービスの中には、サービスが終了してしまったものもある。

近年だと、2019年にサービス終了した「RawGit」がある。

### セキュリティ

CDNが悪意の第三者により書き換えられてしまう可能性もある。

そこで、SRIと呼ばれるセキュリティチェックの仕組みが用意されている。

**サブリソース完全性(SRI)**

JavaScriptのライブラリを取り込む`<script>`要素には、サブリソース完全性 **(SRI)** と呼ばれる検証機能が備わっている。

SRIとはJavaScriptのライブラリが改ざんされていないかどうかをハッシュ関数を用いて検証する機能のこと。

**SRIの仕組み**

もし第三者によってライブラリが改ざんされることがあれば、ライブラリのハッシュ値が変化してしまうため、危険なライブラリを読み込む前に読み込みエラーとなる。

### SRIを使ったCDNの利用方法

`script`要素を使用して、以下のように記述する。

```
<script src="URL" integrity="ハッシュ関数-ハッシュ値" crossorigin="anonymous"></script>
```

integrity属性で指定するハッシュ関数とハッシュ値は、SRI Hash Generator(https://www.srihash.org/) というツールを使用すると生成してくれる。

### integrity属性

integrity属性とは、スクリプトなどを読み込む際に改ざんされていないかどうかをチェックをするための属性。

link要素とscript要素で使用可能。

ブラウザが計算したハッシュ値と、integrity属性で指定しているハッシュ値が異なると、改ざんされていると判断してスクリプトが実行されない仕組みとなっている。

### crossorigin属性

crossorigin属性とは、JavaScriptや画像などを他のドメインから読み込む際にかかる制限をコントロールするための属性。

違うドメインから画像などを読み込むことを、**クロスオリジン**と呼ぶ。

通常は、Webページの脆弱性を防ぐため、同一ドメインの**リソース**(JavaScriptや画像)のみしかアクセスできないよう制限がかかっている。  
crossorigin属性を指定してあげることで、その制限を解除することができる。

crossorigin属性の値には以下の2種類がある。

||意味|
|-|-|
|`anonymous`|CookieやSSL証明書、HTTP認証などの信用情報は送信されない。|
|`use-credentials`|CookieやSSL証明書、HTTP認証などの信用情報が送信される。credentialは「証明書」の意味。|

* **WordPressでCORSのトラブル!?**

ちなみにwebサイトを作成する際によく使われるWordPressを利用しているユーザーの中には、CORSの制限によって、サイトに画像が表示されないトラブルが発生している人もいた。

### ドメインとオリジンの違い

ドメイン:`yahoo.co.jp`  
オリジン:`https://yahoo.co.jp:443`

オリジンのドメインとの違いは、**プロトコルとポート番号を含んでいる**という点。

つまり、**オリジン**とは、**ドメインにプロトコルとポート番号を付与したもの**といえる。

**ポート番号**とは、TCP/IP通信において、 コンピュータが通信に使用する**プログラムを識別する**ための番号のこと。

IPアドレスがあればネットワーク上のコンピュータを一意に識別することができるが、プログラムまでは識別できないのでポート番号が必要になる。

### HTTPリクエスト

HTTPリクエストとは、Webブラウザとサーバーがやりとりする時に、ブラウザがサーバーに送る要求(リクエスト)のこと。  

要するに、「このページくださ～い」ってやつ。

HTTPリクエストは、以下の3つで構成される。

    * リクエスト行
    * ヘッダーフィールド
    * ボディ

リクエスト行は、メソッド、URI、HTTPバージョンの3つの要素から構成され、それぞれスペースで区切られる。

**URI**とは、URL(住所)とURN(名前)の総称。つまり、URI=URL+URNとなる。

URLは変わるけど、URN(名前)はずっと変わらない点に注意。

### CORSとは

別のオリジンのサーバーへのアクセスをオリジン間のHTTPリクエストによって許可できる仕組みのこと。Cross-Origin Resource Sharing の略

要するに、HTTPリクエストを送ることで別のオリジンにある画像やJavaScriptにアクセスできるようになる仕組みってことだね。













